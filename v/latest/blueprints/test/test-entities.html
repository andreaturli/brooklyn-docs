<!--
  ~ Licensed to the Apache Software Foundation (ASF) under one
  ~ or more contributor license agreements.  See the NOTICE file
  ~ distributed with this work for additional information
  ~ regarding copyright ownership.  The ASF licenses this file
  ~ to you under the Apache License, Version 2.0 (the
  ~ "License"); you may not use this file except in compliance
  ~ with the License.  You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing,
  ~ software distributed under the License is distributed on an
  ~ "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  ~ KIND, either express or implied.  See the License for the
  ~ specific language governing permissions and limitations
  ~ under the License.
  -->

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Blueprint Test Entities - Apache Brooklyn</title>

<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet" />
<link href="/brooklyn-docs/style/deps/octicons/octicons.css" rel="stylesheet" />
<link href="/brooklyn-docs/style/deps/bootstrap-theme.css" rel="stylesheet" />
<link href="/brooklyn-docs/style/deps/font-awesome-4.2.0/css/font-awesome.min.css" rel="stylesheet" />
<link href="/brooklyn-docs/style/deps/tooltip.css" rel="stylesheet" />
<link href="/brooklyn-docs/style/css/code.css" rel="stylesheet" />
<link href="/brooklyn-docs/style/css/website.css" rel="stylesheet" />

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
</head>

<body class="page">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <div class="navbar-brand">
                <a class="brand-apache" href="http://www.apache.org/">
                    <img src="https://www.apache.org/foundation/press/kit/feather.svg" alt="[Apache]">
                </a>
                
                <a class="brand-brooklyn" href="/brooklyn-docs/"><img src="/brooklyn-docs/img/apache-brooklyn-logo-244px-wide.png" alt="brooklyn"></a>
                
            </div>
        </div>
        <div class="collapse navbar-collapse" id="main-menu">


            <ul class="nav navbar-nav navbar-right">
                
                <li class="dropdown">
                    
                    <a href="/brooklyn-docs/learnmore/index.html" data-toggle="dropdown">learn more <span class="caret"></span></a>
                    
                    <ul class="dropdown-menu" role="menu">
                        <li>
                            <a href="/brooklyn-docs/learnmore/index.html">Learn More</a>
                        </li>
                        <li class="divider"></li>
                        
                        
                        <li >
                            <a href="/brooklyn-docs/learnmore/blueprint-tour.html">Blueprint Tour
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/learnmore/features/index.html">Features
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/learnmore/theory.html">Theory
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/learnmore/catalog/index.html">Browse Catalog
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                    </ul>
                    
                    
                </li>
                
                <li class="dropdown">
                    
                    <a href="/brooklyn-docs/v/latest/start/index.html" data-toggle="dropdown">get started <span class="caret"></span></a>
                    
                    <ul class="dropdown-menu" role="menu">
                        <li>
                            <a href="/brooklyn-docs/v/latest/start/index.html">Get Started</a>
                        </li>
                        <li class="divider"></li>
                        
                        
                        <li >
                            <a href="/brooklyn-docs/v/latest/start/running.html">Running Apache Brooklyn
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/v/latest/start/blueprints.html">Deploying Blueprints
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/v/latest/start/managing.html">Monitoring and Managing Applications
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/v/latest/start/policies.html">Policies
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/v/latest/start/concept-quickstart.html">Brooklyn Concepts Quickstart
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                    </ul>
                    
                    
                </li>
                
                <li class="dropdown active">
                    
                    <a href="/brooklyn-docs/documentation/index.html" data-toggle="dropdown">documentation <span class="caret"></span></a>
                    
                    <ul class="dropdown-menu" role="menu">
                        <li>
                            <a href="/brooklyn-docs/documentation/index.html">Documentation</a>
                        </li>
                        <li class="divider"></li>
                        
                        
                        <li class="section">
                            <a href="/brooklyn-docs/v/latest/index.html">User Guide
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        <li class="divider"></li>
                        
                        
                        <li >
                            <a href="/brooklyn-docs/v/latest/blueprints/creating-yaml.html">Writing Blueprints
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/v/latest/locations/index.html">Deploying Blueprints
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li class="section">
                            <a href="/brooklyn-docs/v/latest/ops/index.html">Reference Guide
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        <li class="divider"></li>
                        
                        
                        <li >
                            <a href="/brooklyn-docs/v/latest/dev/index.html">Developer Guide
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        <li class="divider"></li>
                        <li >
                            <a href="/brooklyn-docs/meta/versions.html">Versions
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/documentation/other-docs.html">Other Resources
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                    </ul>
                    
                    
                </li>
                
                <li class="dropdown">
                    
                    <a href="/brooklyn-docs/community/index.html" data-toggle="dropdown">community <span class="caret"></span></a>
                    
                    <ul class="dropdown-menu" role="menu">
                        <li>
                            <a href="/brooklyn-docs/community/index.html">Community</a>
                        </li>
                        <li class="divider"></li>
                        
                        
                        <li >
                            <a href="/brooklyn-docs/community/mailing-lists.html">Mailing Lists
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/community/irc.html">IRC
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/community/security/index.html">Security Advisories
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="https://issues.apache.org/jira/browse/BROOKLYN">Bug Tracker (JIRA)
                                &nbsp;<span class="octicon octicon-link-external"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/community/how-to-contribute-docs.html">Contributing Documentation
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                    </ul>
                    
                    
                </li>
                
                <li class="dropdown">
                    
                    <a href="/brooklyn-docs/developers/index.html" data-toggle="dropdown">developers <span class="caret"></span></a>
                    
                    <ul class="dropdown-menu" role="menu">
                        <li>
                            <a href="/brooklyn-docs/developers/index.html">Developers</a>
                        </li>
                        <li class="divider"></li>
                        
                        
                        <li >
                            <a href="/brooklyn-docs/developers/code/index.html">Get the Code
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/developers/how-to-contribute.html">How to Contribute
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/v/latest/dev/index.html">Developer Guide
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/developers/committers/index.html">Committer Guide
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/developers/code-standards.html">Code Standards
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/developers/links.html">Handy Places
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="http://github.com/apache/brooklyn">GitHub
                                &nbsp;<span class="octicon octicon-link-external"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="https://issues.apache.org/jira/browse/BROOKLYN">Bug Tracker (JIRA)
                                &nbsp;<span class="octicon octicon-link-external"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                    </ul>
                    
                    
                </li>
                
                <li class="dropdown">
                    
                    <form class="navbar-form">
                        <a href="/brooklyn-docs/download/index.html" class="btn btn-default">download</a>
                    </form>
                    
                </li>
                
            </ul>
        </div>
    </div>
</nav>


<main>
    <div class="container">
        <div class="row">
            <div class="col-md-9 content">
                <div id="page_notes"></div>
                <h1>Blueprint Test Entities</h1>
                
<h2 id="structural-test-entities">Structural Test Entities</h2>

<h3 id="testcase">TestCase</h3>
<p>The <code>TestCase</code> entity acts as a container for a list of child entities which are started <em>sequentially</em>.</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org.apache.brooklyn.test.framework.TestCase</span>
  <span class="l-Scalar-Plain">brooklyn.children</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org.apache.brooklyn.entity.database.mysql.MySqlNode</span>
    <span class="l-Scalar-Plain">...</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org.apache.brooklyn.test.framework.TestSensor</span>
    <span class="l-Scalar-Plain">...</span></code></pre></div>

<p>This can be used to enforce a strict ordering, for example ensuring a sensor has a certain value before attempting to invoke an effector.</p>

<p>Timeouts on child entities should be set relative to the completion of the preceding entity.</p>

<p>The <code>ParallelTestCase</code> entity can be added as a child to run a subset of entities in parallel as a single step.</p>

<h3 id="paralleltestcase">ParallelTestCase</h3>
<p>The <code>ParallelTestCase</code> entity acts as a container for a list of child entities which are started in <em>parallel</em>.</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org.apache.brooklyn.test.framework.ParallelTestCase</span>
  <span class="l-Scalar-Plain">brooklyn.children</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org.apache.brooklyn.entity.database.mysql.MySqlNode</span>
    <span class="l-Scalar-Plain">...</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org.apache.brooklyn.entity.webapp.ControlledDynamicWebAppCluster</span>
    <span class="l-Scalar-Plain">...</span></code></pre></div>

<p>This can be used to run a subset of entities in parallel as a single step when nested under a <code>TestCase</code> entity.</p>

<p>Timeouts on child entities should be set relative to the start of the <code>ParallelTestCase</code>.</p>

<h3 id="loopovergroupmemberstestcase">LoopOverGroupMembersTestCase</h3>
<p>The <code>LoopOverGroupMembersTestCase</code> entity is configured with a target group and a test specification. For each member of the targeted group, the test case will create a TargetableTestComponent entity from the supplied test specification and set the components target to be the group member.</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org.apache.brooklyn.test.framework.LoopOverGroupMembersTestCase</span>
  <span class="l-Scalar-Plain">target</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">$brooklyn:entity(&quot;infrastructure&quot;).component(&quot;child&quot;, &quot;DockerHosts&quot;)</span>
  <span class="l-Scalar-Plain">testSpec</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">$brooklyn:entitySpec</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org.apache.brooklyn.test.framework.TestSensor</span>
      <span class="l-Scalar-Plain">...</span></code></pre></div>

<h4 id="parameters">Parameters</h4>
<ul>
  <li><code>target</code> - group who’s members are to be tested, specified via DSL. For example, <code>$brooklyn:entity("tomcat")</code>. See also the <code>targetId</code> parameter.</li>
  <li><code>targetId</code> - alternative to the <code>target</code> parameter which wraps the DSL component lookup requiring only the <code>id</code> be supplied. For example, <code>tomcat</code>. Please note, this must point to a group.</li>
  <li><code>test.spec</code> - The TargetableTestComponent to create for each child.</li>
</ul>

<h3 id="infrastructuredeploymenttestcase">InfrastructureDeploymentTestCase</h3>
<p>The <code>InfrastructureDeploymentTestCase</code> will first create and deploy an infrastructure from the <code>infrastructure.deployment.spec</code> config. It will then retrieve a deployment location by getting the value of the infrastructures <code>infrastructure.deployment.location.sensor</code> sensor. It will then create and deploy all entities from the <code>infrastructure.deployment.spec</code> config to the deployment location.</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org.apache.brooklyn.test.framework.InfrastructureDeploymentTestCase</span>
  <span class="l-Scalar-Plain">brooklyn.config</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">infrastructure.deployment.location.sensor</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">entity.dynamicLocation</span>
    <span class="l-Scalar-Plain">infrastructure.deployment.spec</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">$brooklyn:entitySpec</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">docker-cloud-calico</span>
          <span class="l-Scalar-Plain">...</span>
    <span class="l-Scalar-Plain">infrastructure.deployment.entity.specs</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">$brooklyn:entitySpec</span><span class="p-Indicator">:</span>
          <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org.apache.brooklyn.entity.software.base.VanillaSoftwareProcess</span>
          <span class="l-Scalar-Plain">...</span></code></pre></div>

<h4 id="parameters-1">Parameters</h4>

<ul>
  <li><code>infrastructure.deployment.spec</code> - the infrastructure to be deployed.</li>
  <li><code>infrastructure.deployment.entity.specs</code> - the entities to be deployed to the infrastructure</li>
  <li><code>infrastructure.deployment.location.sensor</code> - the name of the sensor on the infrastructure to retrieve the deployment location</li>
</ul>

<h2 id="validation-test-entities">Validation Test Entities</h2>

<h3 id="testsensor">TestSensor</h3>
<p>The <code>TestSensor</code> entity performs an assertion on a specified sensors value.</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org.apache.brooklyn.test.framework.TestSensor</span>
  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Check tomcat isUp</span>
  <span class="l-Scalar-Plain">target</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">$brooklyn:entity(&quot;tomcat&quot;)</span>
  <span class="l-Scalar-Plain">sensor</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service.isUp</span>
  <span class="l-Scalar-Plain">timeout</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">10m</span>
  <span class="l-Scalar-Plain">assert</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">equals</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span></code></pre></div>

<h4 id="parameters-2">Parameters</h4>
<ul>
  <li><code>target</code> - entity whose sensor will be tested, specified via DSL. For example, <code>$brooklyn:entity("tomcat")</code>. See also the <code>targetId</code> parameter.</li>
  <li><code>targetId</code> - alternative to the <code>target</code> parameter which wraps the DSL component lookup requiring only the <code>id</code> be supplied. For example, <code>tomcat</code>.</li>
  <li><code>sensor</code> - sensor to evaluate. For example <code>service.isUp</code>.</li>
  <li><code>timeout</code> - duration to wait on assertion to return a result. For example <code>10s</code>, <code>10m</code>, etc</li>
  <li><code>assert</code> - assertion to perform on the specified sensor value. See section on assertions below.</li>
</ul>

<div class="alert alert-info">
    <strong>Tip:</strong> If the <code>TestSensor</code> is wrapped within a <code>TestCase</code>, 
    <code>ParallelTestCase</code> or <code>LoopOverGroupMembersTestCase</code> that set the target, 
    <strong>you don't need to specify the target</strong>, unless you want to test a different entity.
</div>

<h3 id="testeffector">TestEffector</h3>
<p>The <code>TestEffector</code> entity invokes the specified effector on a target entity. If the result of the effector is a String, it will then perform assertions on the result.</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org.apache.brooklyn.test.framework.TestEffector</span>
  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Invoke Deploy Effector</span>
  <span class="l-Scalar-Plain">target</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">$brooklyn:entity(&quot;tomcat&quot;)</span>
  <span class="l-Scalar-Plain">effector</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">deploy</span>
  <span class="l-Scalar-Plain">timeout</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">5m</span>
  <span class="l-Scalar-Plain">params</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://search.maven.org/remotecontent?filepath=org/apache/brooklyn/example/brooklyn-example-hello-world-sql-webapp/0.8.0-incubating/brooklyn-example-hello-world-sql-webapp-0.8.0-incubating.war</span>
    <span class="l-Scalar-Plain">targetName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">newcontext</span></code></pre></div>

<h4 id="parameters-3">Parameters</h4>
<ul>
  <li><code>target</code> - entity whose effector will be invoked, specified via DSL. For example, <code>$brooklyn:entity("tomcat")</code>. See also the <code>targetId</code> parameter.</li>
  <li><code>targetId</code> - alternative to the <code>target</code> parameter which wraps the DSL component lookup requiring only the <code>id</code> be supplied. For example, <code>tomcat</code>.</li>
  <li><code>timeout</code> - duration to wait on the effector task to complete. For example <code>10s</code>, <code>10m</code>, etc</li>
  <li><code>effector</code> - effector to invoke, for example <code>deploy</code>.</li>
  <li><code>params</code> - parameters to pass to the effector, these will depend on the entity and effector being tested. The example above shows the <code>url</code> and <code>targetName</code> parameters being passed to Tomcats <code>deploy</code> effector.</li>
  <li><code>assert</code> - assertion to perform on the returned result. See section on assertions below.</li>
</ul>

<div class="alert alert-info">
    <strong>Tip:</strong> If the <code>TestEffector</code> is wrapped within a <code>TestCase</code>, 
    <code>ParallelTestCase</code> or <code>LoopOverGroupMembersTestCase</code> that set the target, 
    <strong>you don't need to specify the target</strong>, unless you want to test a different entity.
</div>

<h3 id="testhttpcall">TestHttpCall</h3>
<p>The <code>TestHttpCall</code> entity performs a HTTP GET on the specified URL and performs an assertion on the response.</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org.apache.brooklyn.test.framework.TestHttpCall</span>
  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Check HTTP Response Status Code</span>
  <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">$brooklyn:entity(&quot;tomcat&quot;).attributeWhenReady(&quot;webapp.url&quot;)</span>
  <span class="l-Scalar-Plain">timeout</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">60s</span>
  <span class="l-Scalar-Plain">applyAssertionTo</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">status</span>
  <span class="l-Scalar-Plain">assert</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">isEqualTo</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">200</span></code></pre></div>

<h4 id="parameters-4">Parameters</h4>
<ul>
  <li><code>url</code> - URL to perform GET request on, this can use DSL for example <code>$brooklyn:entity("tomcat").attributeWhenReady("webapp.url")</code>.</li>
  <li><code>timeout</code> - duration to wait on a HTTP response. For example <code>10s</code>, <code>10m</code>, etc</li>
  <li><code>applyAssertionTo</code> - The filed to apply the assertion to. For example <code>status</code>, <code>body</code></li>
  <li><code>assert</code> - assertion to perform on the response.  See section on assertions below.</li>
</ul>

<div class="alert alert-info">
    <strong>Tip:</strong> If the <code>TestHttpCall</code> is wrapped within a <code>TestCase</code>, 
    <code>ParallelTestCase</code> or <code>LoopOverGroupMembersTestCase</code> that set the target, 
    <strong>you don't need to specify the target</strong>, unless you want to test a different entity.
</div>

<h3 id="testsshcommand">TestSshCommand</h3>
<p>The TestSshCommand runs a command on the host of the target entity.
The script is expected not to run indefinitely, but to return a result (process exit code), along with its
standard out and error streams, which can then be tested using assertions.
If no assertions are explicitly configured, the default is to assert a non-zero exit code.</p>

<p>Either a bash command may be provided in the YAML, or a URL for a script which will be executed.</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org.apache.brooklyn.test.framework.TestCase</span>
  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">testcase1</span>
  <span class="l-Scalar-Plain">brooklyn.children</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org.apache.brooklyn.entity.webapp.tomcat.TomcatServer</span>
      <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">testprocess</span>

    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org.apache.brooklyn.test.framework.TestSshCommand</span>
      <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Check tomcat process running with ps</span>
      <span class="l-Scalar-Plain">targetId</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">testprocess</span>
      <span class="l-Scalar-Plain">command</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ps -ef</span>
      <span class="l-Scalar-Plain">assertStatus</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">equals</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0</span>
      <span class="l-Scalar-Plain">assertOut</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">contains</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tomcat</span>
      <span class="l-Scalar-Plain">assertErr</span><span class="p-Indicator">:</span> 
        <span class="l-Scalar-Plain">isEmpty</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>

    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org.apache.brooklyn.test.framework.TestSshCommand</span>
      <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Check hello world script</span>
      <span class="l-Scalar-Plain">targetId</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">testprocess</span>
      <span class="l-Scalar-Plain">downloadUrl</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://github.com/apache/brooklyn-docs/raw/master/guide/blueprints/test/example_yaml/entities/script1.sh</span>
      <span class="l-Scalar-Plain">assertStatus</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">equals</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0</span>
      <span class="l-Scalar-Plain">assertOut</span><span class="p-Indicator">:</span> 
        <span class="l-Scalar-Plain">equals</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">hello world</span>
      <span class="l-Scalar-Plain">assertErr</span><span class="p-Indicator">:</span> 
        <span class="l-Scalar-Plain">isEmpty</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span></code></pre></div>

<h4 id="parameters-5">Parameters</h4>
<ul>
  <li><code>command</code> - The shell command to execute. (This and <code>downloadUrl</code> are mutually exclusive.)</li>
  <li><code>downloadUrl</code> - URL for a script to download and execute. (This and <code>command</code> are mutually exclusive.)</li>
  <li><code>shell.env</code> - Map of environment variables to be set.</li>
  <li><code>scriptDir</code> - if <code>downloadUrl</code> is used.  The directory on the target host where downloaded scripts should be copied to.</li>
  <li><code>runDir</code> - the working directory where the command or script will be executed on the target host.</li>
  <li><code>assertStatus</code> - Assertions on the exit code of the command or script. See section on assertions below.</li>
  <li><code>assertOut</code> - Assertions on the standard output of the command as a String.</li>
  <li><code>assertErr</code> -  Assertions on the standard error of the command as a String.</li>
</ul>

<div class="alert alert-info">
    <strong>Tip:</strong> If the <code>TestSshCommand</code> is wrapped within a <code>TestCase</code>, 
    <code>ParallelTestCase</code> or <code>LoopOverGroupMembersTestCase</code> that set the target, 
    <strong>you don't need to specify the target</strong>, unless you want to test a different entity.
</div>

<h2 id="assertions">Assertions</h2>

<p>The following conditions are provided by those test entities above that include assertions</p>

<ul>
  <li><code>isNull</code> - asserts that the actual value is <code>null</code>.</li>
  <li><code>notNull</code> - asserts that the actual value is NOT <code>null</code>.</li>
  <li><code>isEqualTo</code> - asserts that the actual value equals an expected value.</li>
  <li><code>equalTo</code> - a synonym for <code>isEqualTo</code></li>
  <li><code>equals</code> - a synonym for <code>isEqualTo</code></li>
  <li><code>notEqual</code> - asserts that the actual value does not equal the expected value.</li>
  <li><code>matches</code> - asserts that the actual value matches a <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html?is-external=true">regex pattern</a>, for example <code>".*hello.*"</code>.
Note that regular expressions follow the Java defaults, e.g. for <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#lt">line terminators</a>. 
One can use <code>"(?m)"</code> for multi-line mode (so that <code>^</code> and <code>$</code> also match just after/before line terminators, 
rather than just the start/end of the entire input sequence). The dotall mode, set with <code>"(?s)"</code>, can also 
be useful (so that <code>.</code> matches any character, including line terminators). </li>
  <li><code>containsMatch</code> - asserts that the value contains a string that matches a regex. It follow the behaviour of 
the <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Matcher.html#find()">Matcher.find() method</a>.
This can be useful for simplifying matching in multi-line input.</li>
  <li><code>contains</code> - asserts that the actual value contains the supplied value</li>
  <li><code>isEmpty</code> - asserts that the actual value is an empty string</li>
  <li><code>notEmpty</code> - asserts that the actual value is a non empty string</li>
  <li><code>hasTruthValue</code> - asserts that the actual value has the expected interpretation as a boolean</li>
  <li><code>greaterThan</code> - asserts that the actual value is greater than the expected value according to Java’s
<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Comparable.html">Comparable</a> interface. Actual and
expected must be instances of the same type and implement <code>Comparable</code>.</li>
  <li><code>lessThan</code> - asserts that the actual value is less than the expected value according to Java’s
<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Comparable.html">Comparable</a> interface. Actual and
expected must be instances of the same type and implement <code>Comparable</code>.</li>
</ul>

<p>Assertions may be provided as a simple map:</p>

<pre><code>assert:
  contains: 2 users
  matches: .*[\d]* days.*
</code></pre>

<p>If there is the need to make multiple assertions with the same key, the assertions can be specified
as a list of such maps:</p>

<pre><code>assert:
 - contains: 2 users
 - contains: 2 days
</code></pre>

            </div>

            <aside class="col-md-3">
                <div class="list-group side-menu" id="side-menu">



  
     
              
                  <h4 class=" with_following">
                    <a href="/brooklyn-docs/v/latest/index.html" class="list-group-item breadcrumb breadcrumb0">
                      User Guide
                      </a></h4>
              
                  <h4 class=" with_preceding with_following">
                    <a href="/brooklyn-docs/v/latest/blueprints/index.html" class="list-group-item breadcrumb breadcrumb1">
                      Writing Blueprints
                      </a></h4>
              
                  <h4 class=" with_preceding">
                    <a href="/brooklyn-docs/v/latest/blueprints/test/index.html" class="list-group-item breadcrumb breadcrumb2">
                      Testing YAML Blueprints
                      </a></h4>
              
              
                 
                
                  
                  <a href="/brooklyn-docs/v/latest/blueprints/test/test-entities.html" class="list-group-item active">Test Entities
                    </a>
                
              
                 
                
                  
                  <a href="/brooklyn-docs/v/latest/blueprints/test/usage-examples.html" class="list-group-item">Example Tests
                    </a>
                
              
        
        
  

        
</div>
<div id="width_reference"></div>


<script language="JavaScript" type="application/javascript">
(function($){
    
    sidemenu_x_sizer=function(){ $('#side-menu').width($('#side-menu').parent().find('#width_reference').outerWidth()); };
    $(sidemenu_x_sizer);
    $(window).resize(sidemenu_x_sizer);

    
    sidemenu_y_nonfloater=function(){
      if ($('#side-menu').outerHeight(true) + $('#header').outerHeight(true) + $('#footer').outerHeight(true) > window.innerHeight ||
          $('#side-menu').width() >= $('#content_container').width()/2) {
        $('#side-menu').css('position', 'inherit');
      } else {
        // restore if screen has grown
        $('#side-menu').css('position', 'fixed');
      }
    };
    $(sidemenu_y_nonfloater);
    $(window).resize(sidemenu_y_nonfloater);

    

    var sideMenu = $("#side-menu"),
        sideItems = sideMenu.find("a"),
        // Anchors corresponding to menu items
        scrollItems = sideItems.map(function(){
          var item = $(this).attr("section-target");
          if (item && item.length) { return item; }
        });

    var highlight_section_last_top = -1;
    var highlight_section_completed = false;

    var highlight_section = function() {
       // Get container scroll position
       var highlight_section_new_top = $(this).scrollTop();
       if (highlight_section_new_top == highlight_section_last_top) return;
       var highlight_section_new_bottom = highlight_section_new_top + $(window).height();
       var scroll_advancing = (highlight_section_new_top > highlight_section_last_top);

       var last_item = null, active_item = $("#side-menu a.section#active");

       var found_top = false;
       var displayable_items = scrollItems.map(function(itemI){
         item = $(scrollItems[itemI]);
         if (item && item.length) {
           if (highlight_section_last_top == -1 || !highlight_section_completed) {
             // just opening page - take item matching hash, or otherwise the first item visible
             if (item.selector === window.location.hash || (item.offset().top > highlight_section_new_top - 20 && !found_top)) {
               found_top = true;
               if (item.selector === window.location.hash && item.offset().top < highlight_section_new_top + 60) {
                 // because of our top header, we need to scroll 64px down from any link
                 $('html, body').animate({scrollTop: item.offset().top - 64}, 0);
               }
               return item;
             }
           } else if (scroll_advancing) {
             // if scrolling advance, pick up a section when title starts before 1/3 height
             if (item.offset().top < highlight_section_new_top + $(window).height()/3)
               return item;

             // or if containing div is finished (usu the whole main content)
             div_containing_item = item.closest("div");
             if (div_containing_item.offset().top + div_containing_item.height() < highlight_section_new_bottom + 15)
               return item;
             // or when next title is visible
             if (last_item && item.offset().top < highlight_section_new_bottom + 15)
               return last_item;
           } else {
             // if scrolling back, pick up a section as soon as the title is visible,
             if (item.offset().top < highlight_section_new_top)
               return item;
             // or if title is before the 2/3 point
             // (not sure about this, probably want also to have
             // "AND the id.top is <= displayable_itemsrent_active_it.top" so we don't jump FORWARD a section
             // when scrolling BACK, with lots of tiny sections)
             if ((item.offset().top < highlight_section_new_top + 2*$(window).height()/3)
                 && (!active_item || !active_item.offset() || active_item.offset().top >= item.offset().top))
               return item;

           }
           last_item = item;
         }
       });
       if (!highlight_section_completed && document.readyState === "complete") {
         highlight_section_completed = true;
       }
       if (!displayable_items.length) {
         $("#side-menu a.section").removeClass("active");
       } else {
         displayable_items = displayable_items[displayable_items.length-1];
         var id = displayable_items && displayable_items.length ? displayable_items[0].id : "";
       // Set/remove active class
         new_active = $("#side-menu a.section").filter("[section-target='#"+id+"']");
         if (new_active.hasClass("active")) {
           // nothing needed
         } else {
           $("#side-menu a.section").removeClass("active");
           $("#side-menu a.section").filter("[section-target='#"+id+"']").addClass("active");
         }
       }

       highlight_section_last_top = highlight_section_new_top;
    };
    var highlight_new_section = function() {
      highlight_section_completed = false;
      highlight_section_last_top = -1;
      highlight_section();
    }

    $(window).scroll(highlight_section);
    $(highlight_new_section);

    // detect link change - courtesy http://www.bennadel.com/blog/1520-binding-events-to-non-dom-objects-with-jquery.htm

    // Default to the current location.
    var strLocation = window.location.href;
    var strHash = window.location.hash;
    var strPrevLocation = "";
    var strPrevHash = "";

    // This is how often we will be checkint for
    // changes on the location.
    var intIntervalTime = 100;

    // This method removes the pound from the hash.
    var fnCleanHash = function( strHash ){
        return(
            strHash.substring( 1, strHash.length )
            );
    }

    // This will be the method that we use to check
    // changes in the window location.
    var fnCheckLocation = function(){
        // Check to see if the location has changed.
        if (strLocation != window.location.href){

            // Store the new and previous locations.
            strPrevLocation = strLocation;
            strPrevHash = strHash;
            strLocation = window.location.href;
            strHash = window.location.hash;

            // The location has changed. Trigger a
            // change event on the location object,
            // passing in the current and previous
            // location values.
            $( window.location ).trigger(
                "change",
                {
                    currentHref: strLocation,
                    currentHash: fnCleanHash( strHash ),
                    previousHref: strPrevLocation,
                    previousHash: fnCleanHash( strPrevHash )
                }
                );

        }
    }

    // Set an interval to check the location changes.
    setInterval( fnCheckLocation, intIntervalTime );

    // and trigger highlight section on link change
    $(window.location).bind("change", highlight_new_section);
})(jQuery);

</script>

            </aside>
        </div>
    </div>
</main>

<footer class="container">
    <div class="row">
        <div class="col-md-9">
            <p>Apache Brooklyn is distributed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License v2.0</a>.</p>
        </div>
        <div class="col-md-3 text-right">
            <p>
                <a class="btn btn-sm btn-default" href="https://github.com/apache/brooklyn-docs/edit/master/guide/blueprints/test/test-entities.md">Edit This Page</a>
                <a href="https://brooklyn.apache.org/community/how-to-contribute-docs.html"
                    data-toggle="tooltip" data-placement="top" title="" data-delay="400" data-original-title="How to Edit Documentation">
                    <span class="octicon octicon-question octicon-footer"></span>
                </a>
            </p>
        </div>
    </div>
</footer>

</body>

<!--
  ~ Licensed to the Apache Software Foundation (ASF) under one
  ~ or more contributor license agreements.  See the NOTICE file
  ~ distributed with this work for additional information
  ~ regarding copyright ownership.  The ASF licenses this file
  ~ to you under the Apache License, Version 2.0 (the
  ~ "License"); you may not use this file except in compliance
  ~ with the License.  You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing,
  ~ software distributed under the License is distributed on an
  ~ "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  ~ KIND, either express or implied.  See the License for the
  ~ specific language governing permissions and limitations
  ~ under the License.
  -->

<script type="text/javascript" src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/brooklyn-docs/style/deps/jquery.cookie.js"></script>
<script type="text/javascript" src="/brooklyn-docs/style/js/zeroclipboard/ZeroClipboard.min.js"></script>
<script type="text/javascript" src="/brooklyn-docs/style/deps/tooltip.js"></script>

<script type="text/javascript">
    ZeroClipboard.config({ moviePath: '/style/js/zeroclipboard/ZeroClipboard.swf' });
</script>
<script src="/brooklyn-docs/style/js/public.js"></script>
</html>
