<!--
  ~ Licensed to the Apache Software Foundation (ASF) under one
  ~ or more contributor license agreements.  See the NOTICE file
  ~ distributed with this work for additional information
  ~ regarding copyright ownership.  The ASF licenses this file
  ~ to you under the Apache License, Version 2.0 (the
  ~ "License"); you may not use this file except in compliance
  ~ with the License.  You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing,
  ~ software distributed under the License is distributed on an
  ~ "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  ~ KIND, either express or implied.  See the License for the
  ~ specific language governing permissions and limitations
  ~ under the License.
  -->

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Defining and Deploying - Apache Brooklyn</title>

<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet" />
<link href="/brooklyn-docs/style/deps/octicons/octicons.css" rel="stylesheet" />
<link href="/brooklyn-docs/style/deps/bootstrap-theme.css" rel="stylesheet" />
<link href="/brooklyn-docs/style/deps/font-awesome-4.2.0/css/font-awesome.min.css" rel="stylesheet" />
<link href="/brooklyn-docs/style/deps/tooltip.css" rel="stylesheet" />
<link href="/brooklyn-docs/style/css/code.css" rel="stylesheet" />
<link href="/brooklyn-docs/style/css/website.css" rel="stylesheet" />

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
</head>

<body class="page">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <div class="navbar-brand">
                <a class="brand-apache" href="http://www.apache.org/">
                    <img src="https://www.apache.org/foundation/press/kit/feather.svg" alt="[Apache]">
                </a>
                
                <a class="brand-brooklyn" href="/brooklyn-docs/"><img src="/brooklyn-docs/img/apache-brooklyn-logo-244px-wide.png" alt="brooklyn"></a>
                
            </div>
        </div>
        <div class="collapse navbar-collapse" id="main-menu">


            <ul class="nav navbar-nav navbar-right">
                
                <li class="dropdown">
                    
                    <a href="/brooklyn-docs/learnmore/index.html" data-toggle="dropdown">learn more <span class="caret"></span></a>
                    
                    <ul class="dropdown-menu" role="menu">
                        <li>
                            <a href="/brooklyn-docs/learnmore/index.html">Learn More</a>
                        </li>
                        <li class="divider"></li>
                        
                        
                        <li >
                            <a href="/brooklyn-docs/learnmore/blueprint-tour.html">Blueprint Tour
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/learnmore/features/index.html">Features
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/learnmore/theory.html">Theory
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/learnmore/catalog/index.html">Browse Catalog
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                    </ul>
                    
                    
                </li>
                
                <li class="dropdown">
                    
                    <a href="/brooklyn-docs/v/latest/start/index.html" data-toggle="dropdown">get started <span class="caret"></span></a>
                    
                    <ul class="dropdown-menu" role="menu">
                        <li>
                            <a href="/brooklyn-docs/v/latest/start/index.html">Get Started</a>
                        </li>
                        <li class="divider"></li>
                        
                        
                        <li >
                            <a href="/brooklyn-docs/v/latest/start/running.html">Running Apache Brooklyn
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/v/latest/start/blueprints.html">Deploying Blueprints
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/v/latest/start/managing.html">Monitoring and Managing Applications
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/v/latest/start/policies.html">Policies
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/v/latest/start/concept-quickstart.html">Brooklyn Concepts Quickstart
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                    </ul>
                    
                    
                </li>
                
                <li class="dropdown active">
                    
                    <a href="/brooklyn-docs/documentation/index.html" data-toggle="dropdown">documentation <span class="caret"></span></a>
                    
                    <ul class="dropdown-menu" role="menu">
                        <li>
                            <a href="/brooklyn-docs/documentation/index.html">Documentation</a>
                        </li>
                        <li class="divider"></li>
                        
                        
                        <li class="section">
                            <a href="/brooklyn-docs/v/latest/index.html">User Guide
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        <li class="divider"></li>
                        
                        
                        <li >
                            <a href="/brooklyn-docs/v/latest/blueprints/creating-yaml.html">Writing Blueprints
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/v/latest/locations/index.html">Deploying Blueprints
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li class="section">
                            <a href="/brooklyn-docs/v/latest/ops/index.html">Reference Guide
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        <li class="divider"></li>
                        
                        
                        <li >
                            <a href="/brooklyn-docs/v/latest/dev/index.html">Developer Guide
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        <li class="divider"></li>
                        <li >
                            <a href="/brooklyn-docs/meta/versions.html">Versions
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/documentation/other-docs.html">Other Resources
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                    </ul>
                    
                    
                </li>
                
                <li class="dropdown">
                    
                    <a href="/brooklyn-docs/community/index.html" data-toggle="dropdown">community <span class="caret"></span></a>
                    
                    <ul class="dropdown-menu" role="menu">
                        <li>
                            <a href="/brooklyn-docs/community/index.html">Community</a>
                        </li>
                        <li class="divider"></li>
                        
                        
                        <li >
                            <a href="/brooklyn-docs/community/mailing-lists.html">Mailing Lists
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/community/irc.html">IRC
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/community/security/index.html">Security Advisories
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="https://issues.apache.org/jira/browse/BROOKLYN">Bug Tracker (JIRA)
                                &nbsp;<span class="octicon octicon-link-external"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/community/how-to-contribute-docs.html">Contributing Documentation
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                    </ul>
                    
                    
                </li>
                
                <li class="dropdown">
                    
                    <a href="/brooklyn-docs/developers/index.html" data-toggle="dropdown">developers <span class="caret"></span></a>
                    
                    <ul class="dropdown-menu" role="menu">
                        <li>
                            <a href="/brooklyn-docs/developers/index.html">Developers</a>
                        </li>
                        <li class="divider"></li>
                        
                        
                        <li >
                            <a href="/brooklyn-docs/developers/code/index.html">Get the Code
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/developers/how-to-contribute.html">How to Contribute
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/v/latest/dev/index.html">Developer Guide
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/developers/committers/index.html">Committer Guide
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/developers/code-standards.html">Code Standards
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="/brooklyn-docs/developers/links.html">Handy Places
                                </a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="http://github.com/apache/brooklyn">GitHub
                                &nbsp;<span class="octicon octicon-link-external"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                        
                        <li >
                            <a href="https://issues.apache.org/jira/browse/BROOKLYN">Bug Tracker (JIRA)
                                &nbsp;<span class="octicon octicon-link-external"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li>test 1</li>
                                <li>test 1</li>
                                <li>test 1</li>
                            </ul>
                        </li>
                        
                        
                    </ul>
                    
                    
                </li>
                
                <li class="dropdown">
                    
                    <form class="navbar-form">
                        <a href="/brooklyn-docs/download/index.html" class="btn btn-default">download</a>
                    </form>
                    
                </li>
                
            </ul>
        </div>
    </div>
</nav>


<main>
    <div class="container">
        <div class="row">
            <div class="col-md-9 content">
                <div id="page_notes"></div>
                <h1>Defining and Deploying</h1>
                <h2 id="intro">Intro</h2>

<p>This walkthrough will set up a simple entity, add it to the catalog, and provision it.</p>

<p>For illustration purposes, we will write an integration with <a href="https://gist.github.com/">Github Gist</a>, 
with an effector to create new gists.</p>

<h2 id="project-setup">Project Setup</h2>

<p>Follow the instructions to create a new Java project using the <a href="archetype.html">archetype</a>, and
import it into your <a href="/brooklyn-docs/v/latest/dev/env/ide/">favorite IDE</a>. This example assumes you
used the groupId <code>com.acme</code> and artifact id <code>autobrick</code>.</p>

<p>First ensure you can build this project at the command line, using <code>mvn clean install</code>.</p>

<h2 id="java-entity-classes">Java Entity Classes</h2>

<p>For this particular example, we will use a third party Gist library, so will need to add that as 
a dependency. Add the following to your <code>pom.xml</code> inside the <code>&lt;dependencies&gt;</code> section 
(see <a href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html">Maven</a> 
for more details):</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.eclipse.mylyn.github<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>org.eclipse.egit.github.core<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>2.1.5<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></div>

<p>Create a new Java interface, <code>GistGenerator</code>, to describe the entity’s interface (i.e. the 
configuration options, sensors, and effectors). The code below assumes you have created this
in the package <code>com.acme</code> for <code>src/main/java</code>.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">acme</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.brooklyn.api.entity.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.brooklyn.api.entity.ImplementedBy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.brooklyn.config.ConfigKey</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.brooklyn.core.annotation.Effector</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.brooklyn.core.annotation.EffectorParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.brooklyn.core.config.ConfigKeys</span><span class="o">;</span>

<span class="nd">@ImplementedBy</span><span class="o">(</span><span class="n">GistGeneratorImpl</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">GistGenerator</span> <span class="kd">extends</span> <span class="n">Entity</span> <span class="o">{</span>

    <span class="n">ConfigKey</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">OAUTH_KEY</span> <span class="o">=</span> <span class="n">ConfigKeys</span><span class="o">.</span><span class="na">newStringConfigKey</span><span class="o">(</span><span class="s">&quot;oauth.key&quot;</span><span class="o">,</span> <span class="s">&quot;OAuth key for creating a gist&quot;</span><span class="o">,</span>
            <span class="s">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span><span class="o">);</span>

    <span class="nd">@Effector</span><span class="o">(</span><span class="n">description</span><span class="o">=</span><span class="s">&quot;Create a Gist&quot;</span><span class="o">)</span>
    <span class="n">String</span> <span class="nf">createGist</span><span class="o">(</span>
            <span class="nd">@EffectorParam</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;gistName&quot;</span><span class="o">,</span> <span class="n">description</span><span class="o">=</span><span class="s">&quot;Gist Name&quot;</span><span class="o">,</span> <span class="n">defaultValue</span><span class="o">=</span><span class="s">&quot;Demo Gist&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">gistName</span><span class="o">,</span>
            <span class="nd">@EffectorParam</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;fileName&quot;</span><span class="o">,</span> <span class="n">description</span><span class="o">=</span><span class="s">&quot;File Name&quot;</span><span class="o">,</span> <span class="n">defaultValue</span><span class="o">=</span><span class="s">&quot;Hello.java&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">,</span>
            <span class="nd">@EffectorParam</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;gistContents&quot;</span><span class="o">,</span> <span class="n">description</span><span class="o">=</span><span class="s">&quot;Gist Contents&quot;</span><span class="o">,</span> <span class="n">defaultValue</span><span class="o">=</span><span class="s">&quot;System.out.println(\&quot;Hello World\&quot;);&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">gistContents</span><span class="o">,</span>
            <span class="nd">@EffectorParam</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;oauth.key&quot;</span><span class="o">,</span> <span class="n">description</span><span class="o">=</span><span class="s">&quot;OAuth key for creating a gist&quot;</span><span class="o">,</span> <span class="n">defaultValue</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">oauthKey</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>

    <span class="nd">@Effector</span><span class="o">(</span><span class="n">description</span><span class="o">=</span><span class="s">&quot;Retrieve a Gist&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getGist</span><span class="o">(</span>
            <span class="nd">@EffectorParam</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">description</span><span class="o">=</span><span class="s">&quot;Gist id&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">id</span><span class="o">,</span>
            <span class="nd">@EffectorParam</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;oauth.key&quot;</span><span class="o">,</span> <span class="n">description</span><span class="o">=</span><span class="s">&quot;OAuth key for creating a gist&quot;</span><span class="o">,</span> <span class="n">defaultValue</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">oauthKey</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
<span class="o">}</span></code></pre></div>

<p>To describe each part of this:</p>

<ul>
  <li>The <code>@ImplementedBy</code> indicates the implementation class for this entity type - i.e. the class 
to instantiate when an entity of this type is created.</li>
  <li>By extending <code>Entity</code>, we indicate that this interface is an Entity type. We could alternatively
have extended one of the other sub-types of Entity.</li>
  <li>The <code>OAUTH_KEY</code> is a configuration key - it is configuration that can be set on the entity when 
it is being instantiated.</li>
  <li>The <code>@Effector</code> annotation indicates that the given method is an effector, so should be presented
and tracked as such. Execution of the effector is intercepted, to track it as a task and show its
execution in the Activity view.</li>
  <li>The <code>@EffectorParam</code> annotations give metadata about the effector’s parameters. This metadata,
such as the parameter description, is available to those using the client CLI, rest API and 
web-console.</li>
</ul>

<p>Note there is an alternative way of defining effectors - adding them to the entity dynamically, 
discussed in the section <a href="common-usage.html#dynamically-added-effectors">Dynamically Added Effectors</a>.</p>

<p>Next lets add the implementation. Create a new Java class named <code>GistGeneratorImpl</code>.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">acme</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.brooklyn.core.entity.AbstractEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.brooklyn.util.text.Strings</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.eclipse.egit.github.core.Gist</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.eclipse.egit.github.core.GistFile</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.eclipse.egit.github.core.service.GistService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.common.collect.Iterables</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GistGeneratorImpl</span> <span class="kd">extends</span> <span class="n">AbstractEntity</span> <span class="kd">implements</span> <span class="n">GistGenerator</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">LOG</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">GistGeneratorImpl</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createGist</span><span class="o">(</span><span class="n">String</span> <span class="n">gistName</span><span class="o">,</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">,</span> <span class="n">String</span> <span class="n">gistContents</span><span class="o">,</span> <span class="n">String</span> <span class="n">oathToken</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">Strings</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">oathToken</span><span class="o">))</span> <span class="n">oathToken</span> <span class="o">=</span> <span class="n">config</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">OAUTH_KEY</span><span class="o">);</span>

        <span class="n">GistFile</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">GistFile</span><span class="o">();</span>
        <span class="n">file</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">gistContents</span><span class="o">);</span>
        <span class="n">Gist</span> <span class="n">gist</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Gist</span><span class="o">();</span>
        <span class="n">gist</span><span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="n">gistName</span><span class="o">);</span>
        <span class="n">gist</span><span class="o">.</span><span class="na">setFiles</span><span class="o">(</span><span class="n">Collections</span><span class="o">.</span><span class="na">singletonMap</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="n">file</span><span class="o">));</span>
        <span class="n">gist</span><span class="o">.</span><span class="na">setPublic</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        
        <span class="n">GistService</span> <span class="n">service</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">GistService</span><span class="o">();</span>
        <span class="n">service</span><span class="o">.</span><span class="na">getClient</span><span class="o">().</span><span class="na">setOAuth2Token</span><span class="o">(</span><span class="n">oathToken</span><span class="o">);</span>
        <span class="n">LOG</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Creating Gist: &quot;</span> <span class="o">+</span>  <span class="n">gistName</span><span class="o">);</span>
        <span class="n">Gist</span> <span class="n">result</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">createGist</span><span class="o">(</span><span class="n">gist</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getGist</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">oathToken</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">Strings</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">oathToken</span><span class="o">))</span> <span class="n">oathToken</span> <span class="o">=</span> <span class="n">config</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">OAUTH_KEY</span><span class="o">);</span>

        <span class="n">GistService</span> <span class="n">service</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">GistService</span><span class="o">();</span>
        <span class="n">service</span><span class="o">.</span><span class="na">getClient</span><span class="o">().</span><span class="na">setOAuth2Token</span><span class="o">(</span><span class="n">oathToken</span><span class="o">);</span>
        <span class="n">Gist</span> <span class="n">gist</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">getGist</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">Iterables</span><span class="o">.</span><span class="na">getOnlyElement</span><span class="o">(</span><span class="n">gist</span><span class="o">.</span><span class="na">getFiles</span><span class="o">().</span><span class="na">values</span><span class="o">()).</span><span class="na">getContent</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>To describe each part of this:</p>

<ul>
  <li>Extends <code>AbstractEntity</code> - all entity implementations should extend this, or one of its 
sub-types.</li>
  <li>Implements <code>GistGenerator</code>: this is the Entity type definition, so must be implemented.
Users of the entity will only refer to the interface; they will never be given an instance 
of the concrete class - instead a <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/reflect/Proxy.html">dynamic proxy</a> 
is used (to allow remoting).</li>
  <li><code>org.slf4j.Logger</code> is the logger used throughout Apache Brooklyn.</li>
  <li>Implements the <code>createGist</code> effector - we do not need to re-declare all the annotations.</li>
  <li>If no <code>oath.key</code> parameter was passed in, then use the configuration set on the entity.</li>
  <li>Use the third party library to create the gist.</li>
</ul>

<h3 id="configuring-github">Configuring GitHub</h3>

<p>First, create a github.com account, if you do not already have one.</p>

<p>Before running the blueprint, we’ll need to generate an access token that has permissions to
create a gist programmatically.</p>

<p>First <a href="https://help.github.com/articles/creating-an-access-token-for-command-line-use/">create a new access token</a> 
that our blueprint will use to create a gist:</p>

<p><a href="gist_generator/gist_create_token.png"><img src="gist_generator/gist_create_token.png" alt="Create a new access key." title="Create a new access key" /></a></p>

<p>Next, grant the token rights to create gists:</p>

<p><a href="gist_generator/gist_grant_access.png"><img src="gist_generator/gist_grant_access.png" alt="Grant access." title="Grant access" /></a></p>

<h3 id="testing">Testing</h3>

<p>The archetype project comes with example unit tests that demonstrate how to test entities, 
both within Java and also using YAML-based blueprints. </p>

<p>We will create a similar Java-based test for this blueprint. Create a new Java class named 
<code>GistGeneratorTest</code> in the package <code>com.acme</code>, inside <code>src/test/java</code>.</p>

<p>You will need to substitute the github access token you generated in the previous section for
the placeholder text <code>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</code>.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">acme</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">testng</span><span class="o">.</span><span class="na">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.brooklyn.api.entity.EntitySpec</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.brooklyn.core.test.BrooklynAppUnitTestSupport</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Test</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GistGeneratorTest</span> <span class="kd">extends</span> <span class="n">BrooklynAppUnitTestSupport</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testEntity</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">oathKey</span> <span class="o">=</span> <span class="s">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span><span class="o">;</span>
        <span class="n">GistGenerator</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="na">createAndManageChild</span><span class="o">(</span><span class="n">EntitySpec</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">GistGenerator</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
        <span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="na">createGist</span><span class="o">(</span><span class="s">&quot;myGistName&quot;</span><span class="o">,</span> <span class="s">&quot;myFileName&quot;</span><span class="o">,</span> <span class="s">&quot;myGistContents&quot;</span><span class="o">,</span> <span class="n">oathKey</span><span class="o">);</span>
        
        <span class="n">String</span> <span class="n">contents</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="na">getGist</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">oathKey</span><span class="o">);</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="n">contents</span><span class="o">,</span> <span class="s">&quot;myGistContents&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>Similarly, we can write a test that uses the <code>GistGenerator</code> from a YAML blueprint. 
Create a new Java class named <code>GistGeneratorYamlTest</code> in the package <code>com.acme</code>, 
inside <code>src/test/java</code>.</p>

<p>Again you will need to substitute the github access token you generated in the previous section for
the placeholder text <code>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</code>. See the section on 
<a href="/brooklyn-docs/v/latest/ops/externalized-configuration.html">externalised configuration</a>
for how to store these credentials more securely. </p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">acme</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">testng</span><span class="o">.</span><span class="na">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.brooklyn.api.entity.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.brooklyn.camp.brooklyn.AbstractYamlTest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.brooklyn.core.entity.Entities</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.testng.annotations.Test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.common.base.Joiner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.collect.Iterables</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GistGeneratorYamlTest</span> <span class="kd">extends</span> <span class="n">AbstractYamlTest</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">contents</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testEntity</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">oathKey</span> <span class="o">=</span> <span class="s">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span><span class="o">;</span>
        
        <span class="n">String</span> <span class="n">yaml</span> <span class="o">=</span> <span class="n">Joiner</span><span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="s">&quot;\n&quot;</span><span class="o">).</span><span class="na">join</span><span class="o">(</span>
            <span class="s">&quot;name: my test&quot;</span><span class="o">,</span>
            <span class="s">&quot;services:&quot;</span><span class="o">,</span>
            <span class="s">&quot;- type: com.acme.GistGenerator&quot;</span><span class="o">,</span>
            <span class="s">&quot;  brooklyn.config:&quot;</span><span class="o">,</span>
            <span class="s">&quot;    oauth.key: &quot;</span><span class="o">+</span><span class="n">oathKey</span><span class="o">);</span>
        
        <span class="n">Entity</span> <span class="n">app</span> <span class="o">=</span> <span class="n">createAndStartApplication</span><span class="o">(</span><span class="n">yaml</span><span class="o">);</span>
        <span class="n">waitForApplicationTasks</span><span class="o">(</span><span class="n">app</span><span class="o">);</span>

        <span class="n">Entities</span><span class="o">.</span><span class="na">dumpInfo</span><span class="o">(</span><span class="n">app</span><span class="o">);</span>

        <span class="n">GistGenerator</span> <span class="n">entity</span> <span class="o">=</span> <span class="o">(</span><span class="n">GistGenerator</span><span class="o">)</span> <span class="n">Iterables</span><span class="o">.</span><span class="na">getOnlyElement</span><span class="o">(</span><span class="n">app</span><span class="o">.</span><span class="na">getChildren</span><span class="o">());</span>
        <span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="na">createGist</span><span class="o">(</span><span class="s">&quot;myGistName&quot;</span><span class="o">,</span> <span class="s">&quot;myFileName&quot;</span><span class="o">,</span> <span class="s">&quot;myGistContents&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        
        <span class="n">contents</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="na">getGist</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="n">contents</span><span class="o">,</span> <span class="s">&quot;myGistContents&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<h2 id="building-the-osgi-bundle">Building the OSGi Bundle</h2>

<p>Next we will build this example as an <a href="https://www.osgi.org/developer/architecture/">OSGi Bundle</a> 
so that it can be added to the Apache Brooklyn server at runtime, and so multiple versions of the<br />
blueprint can be managed.</p>

<p>The <code>mvn clean install</code> will automatically do this, creating a jar inside the <code>target/</code> sub-directory
of the project. This works by using the 
<a href="http://felix.apache.org/documentation/subprojects/apache-felix-maven-bundle-plugin-bnd.html">Maven Bundle Plugin</a>
which we get automatically by declaring the <code>pom.xml</code>’s parent as <code>brooklyn-downstream-parent</code>.</p>

<h2 id="adding-to-the-catalog">Adding to the catalog</h2>

<p>Similar to the <code>sample.bom</code> entity that ships with the archetype, we will define a <code>.bom</code> file
to add our <code>GistGenerator</code> to the catalog. Substitute the URL below for your own newly built 
artifact (which will be in the <code>target</code> sub-directory after running <code>mvn clean install</code>).</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">brooklyn.catalog</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">libraries</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">http://search.maven.org/remotecontent?filepath=com/google/code/gson/gson/2.2.2/gson-2.2.2.jar</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">http://repo1.maven.org/maven2/org/apache/servicemix/bundles/org.apache.servicemix.bundles.egit.github.core/2.1.5_1/org.apache.servicemix.bundles.egit.github.core-2.1.5_1.jar</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">http://developers.cloudsoftcorp.com/brooklyn/guide/blueprints/java/gist_generator/autobrick-0.1.0-SNAPSHOT.jar</span>
  <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">example.GistGenerator</span>
  <span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="s">&quot;0.1.0-SNAPSHOT&quot;</span>
  <span class="l-Scalar-Plain">itemType</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">template</span>
  <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">For programmatically generating GitHub Gists</span>
  <span class="l-Scalar-Plain">displayName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Gist Generator</span>
  <span class="l-Scalar-Plain">iconUrl</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">classpath:///sample-icon.png</span>
  <span class="l-Scalar-Plain">item</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">com.acme.GistGenerator</span></code></pre></div>

<p>See <a href="/brooklyn-docs/v/latest/blueprints/java/bundle-dependencies.html">Handling Bundle Dependencies</a>
for a description of the <code>brooklyn.libraries</code> used above, and for other alternative approaches.</p>

<p>The command below will use the <code>br</code> CLI to add this to the catalog of a running Brooklyn instance.
Substitute the credentials, URL and port for those of your server.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>br login https://127.0.0.1:8443 admin pa55w0rd
<span class="nv">$ </span>br catalog add gist_generator.bom</code></pre></div>

<h2 id="using-the-blueprint">Using the blueprint</h2>

<p>The YAML blueprint below shows an example usage of this blueprint:</p>

<pre><code>name: my sample
services:
- type: example.GistGenerator
  brooklyn.config:
    oauth.key: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
</code></pre>

<p>Note the type name matches the id defined in the <code>.bom</code> file.</p>

<p>You can now call the effector by any of the standard means - <a href="/brooklyn-docs/v/latest/ops/gui/">web console</a>,
<a href="/brooklyn-docs/v/latest/ops/rest.html">REST api</a>, or <a href="/brooklyn-docs/v/latest/ops/cli/">Client CLI</a>.</p>

            </div>

            <aside class="col-md-3">
                <div class="list-group side-menu" id="side-menu">



  
     
              
                  <h4 class=" with_following">
                    <a href="/brooklyn-docs/v/latest/index.html" class="list-group-item breadcrumb breadcrumb0">
                      User Guide
                      </a></h4>
              
                  <h4 class=" with_preceding with_following">
                    <a href="/brooklyn-docs/v/latest/blueprints/index.html" class="list-group-item breadcrumb breadcrumb1">
                      Writing Blueprints
                      </a></h4>
              
                  <h4 class=" with_preceding">
                    <a href="/brooklyn-docs/v/latest/blueprints/java/index.html" class="list-group-item breadcrumb breadcrumb2">
                      Java Entities
                      </a></h4>
              
              
                 
                
                  
                  <a href="/brooklyn-docs/v/latest/blueprints/java/archetype.html" class="list-group-item">Creating from a Maven Archetype
                    </a>
                
              
                 
                
                  
                  <a href="/brooklyn-docs/v/latest/blueprints/java/defining-and-deploying.html" class="list-group-item active">Defining and Deploying
                    </a>
                
              
                 
                
                  
                  <a href="/brooklyn-docs/v/latest/blueprints/java/bundle-dependencies.html" class="list-group-item">Handling Bundle Dependencies
                    </a>
                
              
                 
                
                  
                  <a href="/brooklyn-docs/v/latest/blueprints/java/topology-dependencies.html" class="list-group-item">Topology, Dependencies, and Management Policies
                    </a>
                
              
                 
                
                  
                  <a href="/brooklyn-docs/v/latest/blueprints/java/common-usage.html" class="list-group-item">Common Classes and Entities
                    </a>
                
              
                 
                
                  
                  <a href="/brooklyn-docs/v/latest/blueprints/java/feeds.html" class="list-group-item">Feeds
                    </a>
                
              
                 
                
                  
                  <a href="/brooklyn-docs/v/latest/blueprints/java/entity.html" class="list-group-item">Writing an Entity
                    </a>
                
              
                 
                
                  
                  <a href="/brooklyn-docs/v/latest/blueprints/java/entities.html" class="list-group-item">Custom Entity Development
                    </a>
                
              
                 
                
                  
                  <a href="/brooklyn-docs/v/latest/blueprints/java/service-state.html" class="list-group-item">Service State
                    </a>
                
              
                 
                
                  
                  <a href="/brooklyn-docs/v/latest/blueprints/java/entitlements.html" class="list-group-item">Entitlements
                    </a>
                
              
        
        
  

        
</div>
<div id="width_reference"></div>


<script language="JavaScript" type="application/javascript">
(function($){
    
    sidemenu_x_sizer=function(){ $('#side-menu').width($('#side-menu').parent().find('#width_reference').outerWidth()); };
    $(sidemenu_x_sizer);
    $(window).resize(sidemenu_x_sizer);

    
    sidemenu_y_nonfloater=function(){
      if ($('#side-menu').outerHeight(true) + $('#header').outerHeight(true) + $('#footer').outerHeight(true) > window.innerHeight ||
          $('#side-menu').width() >= $('#content_container').width()/2) {
        $('#side-menu').css('position', 'inherit');
      } else {
        // restore if screen has grown
        $('#side-menu').css('position', 'fixed');
      }
    };
    $(sidemenu_y_nonfloater);
    $(window).resize(sidemenu_y_nonfloater);

    

    var sideMenu = $("#side-menu"),
        sideItems = sideMenu.find("a"),
        // Anchors corresponding to menu items
        scrollItems = sideItems.map(function(){
          var item = $(this).attr("section-target");
          if (item && item.length) { return item; }
        });

    var highlight_section_last_top = -1;
    var highlight_section_completed = false;

    var highlight_section = function() {
       // Get container scroll position
       var highlight_section_new_top = $(this).scrollTop();
       if (highlight_section_new_top == highlight_section_last_top) return;
       var highlight_section_new_bottom = highlight_section_new_top + $(window).height();
       var scroll_advancing = (highlight_section_new_top > highlight_section_last_top);

       var last_item = null, active_item = $("#side-menu a.section#active");

       var found_top = false;
       var displayable_items = scrollItems.map(function(itemI){
         item = $(scrollItems[itemI]);
         if (item && item.length) {
           if (highlight_section_last_top == -1 || !highlight_section_completed) {
             // just opening page - take item matching hash, or otherwise the first item visible
             if (item.selector === window.location.hash || (item.offset().top > highlight_section_new_top - 20 && !found_top)) {
               found_top = true;
               if (item.selector === window.location.hash && item.offset().top < highlight_section_new_top + 60) {
                 // because of our top header, we need to scroll 64px down from any link
                 $('html, body').animate({scrollTop: item.offset().top - 64}, 0);
               }
               return item;
             }
           } else if (scroll_advancing) {
             // if scrolling advance, pick up a section when title starts before 1/3 height
             if (item.offset().top < highlight_section_new_top + $(window).height()/3)
               return item;

             // or if containing div is finished (usu the whole main content)
             div_containing_item = item.closest("div");
             if (div_containing_item.offset().top + div_containing_item.height() < highlight_section_new_bottom + 15)
               return item;
             // or when next title is visible
             if (last_item && item.offset().top < highlight_section_new_bottom + 15)
               return last_item;
           } else {
             // if scrolling back, pick up a section as soon as the title is visible,
             if (item.offset().top < highlight_section_new_top)
               return item;
             // or if title is before the 2/3 point
             // (not sure about this, probably want also to have
             // "AND the id.top is <= displayable_itemsrent_active_it.top" so we don't jump FORWARD a section
             // when scrolling BACK, with lots of tiny sections)
             if ((item.offset().top < highlight_section_new_top + 2*$(window).height()/3)
                 && (!active_item || !active_item.offset() || active_item.offset().top >= item.offset().top))
               return item;

           }
           last_item = item;
         }
       });
       if (!highlight_section_completed && document.readyState === "complete") {
         highlight_section_completed = true;
       }
       if (!displayable_items.length) {
         $("#side-menu a.section").removeClass("active");
       } else {
         displayable_items = displayable_items[displayable_items.length-1];
         var id = displayable_items && displayable_items.length ? displayable_items[0].id : "";
       // Set/remove active class
         new_active = $("#side-menu a.section").filter("[section-target='#"+id+"']");
         if (new_active.hasClass("active")) {
           // nothing needed
         } else {
           $("#side-menu a.section").removeClass("active");
           $("#side-menu a.section").filter("[section-target='#"+id+"']").addClass("active");
         }
       }

       highlight_section_last_top = highlight_section_new_top;
    };
    var highlight_new_section = function() {
      highlight_section_completed = false;
      highlight_section_last_top = -1;
      highlight_section();
    }

    $(window).scroll(highlight_section);
    $(highlight_new_section);

    // detect link change - courtesy http://www.bennadel.com/blog/1520-binding-events-to-non-dom-objects-with-jquery.htm

    // Default to the current location.
    var strLocation = window.location.href;
    var strHash = window.location.hash;
    var strPrevLocation = "";
    var strPrevHash = "";

    // This is how often we will be checkint for
    // changes on the location.
    var intIntervalTime = 100;

    // This method removes the pound from the hash.
    var fnCleanHash = function( strHash ){
        return(
            strHash.substring( 1, strHash.length )
            );
    }

    // This will be the method that we use to check
    // changes in the window location.
    var fnCheckLocation = function(){
        // Check to see if the location has changed.
        if (strLocation != window.location.href){

            // Store the new and previous locations.
            strPrevLocation = strLocation;
            strPrevHash = strHash;
            strLocation = window.location.href;
            strHash = window.location.hash;

            // The location has changed. Trigger a
            // change event on the location object,
            // passing in the current and previous
            // location values.
            $( window.location ).trigger(
                "change",
                {
                    currentHref: strLocation,
                    currentHash: fnCleanHash( strHash ),
                    previousHref: strPrevLocation,
                    previousHash: fnCleanHash( strPrevHash )
                }
                );

        }
    }

    // Set an interval to check the location changes.
    setInterval( fnCheckLocation, intIntervalTime );

    // and trigger highlight section on link change
    $(window.location).bind("change", highlight_new_section);
})(jQuery);

</script>

            </aside>
        </div>
    </div>
</main>

<footer class="container">
    <div class="row">
        <div class="col-md-9">
            <p>Apache Brooklyn is distributed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License v2.0</a>.</p>
        </div>
        <div class="col-md-3 text-right">
            <p>
                <a class="btn btn-sm btn-default" href="https://github.com/apache/brooklyn-docs/edit/master/guide/blueprints/java/defining-and-deploying.md">Edit This Page</a>
                <a href="https://brooklyn.apache.org/community/how-to-contribute-docs.html"
                    data-toggle="tooltip" data-placement="top" title="" data-delay="400" data-original-title="How to Edit Documentation">
                    <span class="octicon octicon-question octicon-footer"></span>
                </a>
            </p>
        </div>
    </div>
</footer>

</body>

<!--
  ~ Licensed to the Apache Software Foundation (ASF) under one
  ~ or more contributor license agreements.  See the NOTICE file
  ~ distributed with this work for additional information
  ~ regarding copyright ownership.  The ASF licenses this file
  ~ to you under the Apache License, Version 2.0 (the
  ~ "License"); you may not use this file except in compliance
  ~ with the License.  You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing,
  ~ software distributed under the License is distributed on an
  ~ "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  ~ KIND, either express or implied.  See the License for the
  ~ specific language governing permissions and limitations
  ~ under the License.
  -->

<script type="text/javascript" src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/brooklyn-docs/style/deps/jquery.cookie.js"></script>
<script type="text/javascript" src="/brooklyn-docs/style/js/zeroclipboard/ZeroClipboard.min.js"></script>
<script type="text/javascript" src="/brooklyn-docs/style/deps/tooltip.js"></script>

<script type="text/javascript">
    ZeroClipboard.config({ moviePath: '/style/js/zeroclipboard/ZeroClipboard.swf' });
</script>
<script src="/brooklyn-docs/style/js/public.js"></script>
</html>
